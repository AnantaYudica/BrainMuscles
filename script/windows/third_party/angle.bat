@ECHO OFF

SETLOCAL

CALL ..\environment.bat

SET GYP_GENERATORS=msvs
SET GYP_MSVS_VERSION=2015

SET ANGLE_DIR=%~dp0..\..\..\third_party\angle
SET ANGLE_SCRIPTS_DIR=%ANGLE_DIR%\scripts

CALL :GET_DEPOT_TOOLS_DIR

CALL :VALIDATION_GCLIENT

CALL :VALIDATION_BOOTSTRAP

PUSHD %ANGLE_DIR%
CALL scripts\bootstrap.py
CALL %GCLIENTS% sync
CALL %GCLIENTS% runhooks
POPD

GOTO :END
:TOOLS_VALIDATION
SET NAME_TOOL=
SET NAME_TOOL=%1
SET NAME_TOOL=%NAME_TOOL:"=%



GOTO :END
:GET_DEPOT_TOOLS_DIR

IF NOT "%DEPOT_TOOLS_DIR%"=="" (
	GOTO :END
)

PUSHD %UTILS_DIR%
SET COMMAND_GET_DEPOT_TOOLS=get_dir_from_list.bat "gclient.bat" "%PATH%" ";"

FOR /F %%A IN ('%COMMAND_GET_DEPOT_TOOLS%') DO (
	SET DEPOT_TOOLS_DIR=%%A
)
POPD

GOTO :END
:VALIDATION_GCLIENT

PUSHD %UTILS_DIR%
CALL validation.bat FILE "%DEPOT_TOOLS_DIR%\gclient.bat" "Please install depot_tools"
IF %errorlevel%==0 (SET GCLIENTS="%DEPOT_TOOLS_DIR%\gclient.bat")
POPD

GOTO :END
:VALIDATION_BOOTSTRAP

PUSHD %UTILS_DIR%
CALL validation.bat FILE "%ANGLE_SCRIPTS_DIR%\bootstrap.py" "bootstrap.py not found in %ANGLE_SCRIPTS_DIR%"
POPD

GOTO :END
:END
ENDLOCAL